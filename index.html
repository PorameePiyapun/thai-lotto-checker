<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡πÅ‡∏≠‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏•‡∏≠‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà</title>

    <script src="https://unpkg.com/html5-qrcode"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f7f7f7;
            --box-bg-color: #ffffff;
            --text-color: #333;
            --border-color: #ddd;
            --input-bg: #fff;
            --primary-color: #0078ff;
            --primary-hover: #005fcc;
            --secondary-color: #6c757d;
            --secondary-hover: #5a6268;
            --prize-box-bg: #f0f5ff;
            --prize-box-border: #0078ff;
            --prize-first-color: #d9534f;
            --prize-other-color: #0078ff;
            --result-win-color: #155724;
            --result-lose-color: #721c24;
            --result-invalid-color: #999;
            --result-multi-bg: #fdfdfd;
        }

        body.dark-mode {
            --bg-color: #121212;
            --box-bg-color: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #444;
            --input-bg: #2a2a2a;
            --primary-color: #0098ff;
            --primary-hover: #0078ff;
            --secondary-color: #888;
            --secondary-hover: #aaa;
            --prize-box-bg: #1a2230;
            --prize-box-border: #0098ff;
            --prize-first-color: #ff6b6b;
            --prize-other-color: #0098ff;
            --result-win-color: #5dcf85;
            --result-lose-color: #ff8a8a;
            --result-invalid-color: #888;
            --result-multi-bg: #2a2a2a;
        }

        body {
            font-family: 'Sarabun', Arial, sans-serif;
            padding: 20px 15px; 
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        .theme-button {
            position: absolute;
            top: 10px;
            left: 15px;
            background: var(--box-bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            padding: 0;
            font-size: 1.5rem;
            line-height: 40px;
            text-align: center;
            cursor: pointer;
            font-family: 'Sarabun', Arial, sans-serif;
            z-index: 10;
        }
        
        .box {
            background: var(--box-bg-color);
            padding: 20px;
            border-radius: 10px;
            max-width: 500px; 
            margin: 40px auto 0 auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            transition: background-color 0.3s;
        }
        
        #prize-summary {
            background-color: var(--prize-box-bg);
            border: 2px solid var(--prize-box-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        #prize-summary h3 {
            margin: 0 0 10px 0;
            color: var(--prize-other-color);
        }
        #prize-date {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 10px;
        }
        #prize-first {
            color: var(--prize-first-color);
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
        }
        .prize-label {
            font-size: 1rem;
            font-weight: 700;
            margin: 0;
            color: var(--text-color);
        }
        .prize-row {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        .prize-col {
            width: 33%;
        }
        .prize-number {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--prize-other-color);
        }

        input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
            border-radius: 8px;
            font-size: 18px;
            text-align: center;
            font-family: 'Sarabun', Arial, sans-serif;
            box-sizing: border-box; 
        }
        
        button {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            border: none;
            color: white;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Sarabun', Arial, sans-serif;
            font-weight: bold;
            margin-top: 5px;
            box-sizing: border-box; 
        }
        
        button:hover {
            background: var(--primary-hover);
        }
        
        #reader {
            width: 100%;
            margin-top: 20px;
        }

        @media (min-width: 600px) {
            body {
                padding: 40px; 
            }
        }

        hr {
            margin-top: 25px; 
            margin-bottom: 25px; 
            border: 1px solid var(--border-color);
        }
        h3 {
            text-align:center; 
            margin-top: 0;
            color: var(--text-color);
        }
        #multiInputContainer input {
            margin-bottom: 10px;
        }
        .secondary-button {
            background: var(--secondary-color);
            font-size: 16px;
            font-weight: normal;
        }
        .secondary-button:hover {
            background: var(--secondary-hover);
        }
        #multiResult {
            text-align: left;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            background-color: var(--result-multi-bg);
        }
        .res-line {
            padding: 4px;
            border-bottom: 1px solid var(--border-color);
        }
        .res-win {
            font-weight: 700;
            color: var(--result-win-color);
        }
        .res-lose {
            color: var(--result-lose-color);
        }
        .res-invalid {
            color: var(--result-invalid-color);
            font-style: italic;
        }
    </style>
</head>

<body>
    <button id="themeToggle" class="theme-button">üåô</button>

    <div class="box">
        <h2 style="text-align:center;">‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡∏•‡∏•‡∏≠‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà</h2>

        <div id="prize-summary">
            <h3>‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏á‡∏ß‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
            <div id="prize-date">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            <div id="prize-first-box">
                <p class="prize-label">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1</p>
                <div id="prize-first">-</div>
            </div>
            <div class="prize-row">
                <div class="prize-col">
                    <p class="prize-label">‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏ï‡∏±‡∏ß</p>
                    <div class="prize-number" id="prize-front3">-</div>
                </div>
                <div class="prize-col">
                    <p class="prize-label">‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 3 ‡∏ï‡∏±‡∏ß</p>
                    <div class="prize-number" id="prize-last3">-</div>
                </div>
                <div class="prize-col">
                    <p class="prize-label">‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 2 ‡∏ï‡∏±‡∏ß</p>
                    <div class="prize-number" id="prize-last2">-</div>
                </div>
            </div>
        </div>
        
        <h3>‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
        <div id="multiInputContainer">
            <input type="text" maxlength="6" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å" class="multi-input" />
        </div>
        <button onclick="addInputSlot()" class="secondary-button">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç</button>
        <button onclick="startScan()" class="secondary-button">‡∏™‡πÅ‡∏Å‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á)</button>
        
        <button onclick="checkAllSlots()" style="margin-top: 15px;">‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <div id="multiResult"></div>
        
        <div id="reader" style="display:none;"></div>
    </div>

<script>
    let scannerRunning = false;
    let html5Scanner = null;
    let winningData = null; // Global variable to hold prize data
    let apiLottoDate = "";  // Global variable for the date

    // --- Dark Mode Logic ---
    const themeToggle = document.getElementById('themeToggle');
    const bodyEl = document.body;
    if (localStorage.getItem('theme') === 'dark') {
        bodyEl.classList.add('dark-mode');
        themeToggle.innerText = "‚òÄÔ∏è";
    } else {
        themeToggle.innerText = "üåô";
    }
    themeToggle.addEventListener('click', () => {
        bodyEl.classList.toggle('dark-mode');
        let theme = 'light';
        if (bodyEl.classList.contains('dark-mode')) {
            theme = 'dark';
            themeToggle.innerText = "‚òÄÔ∏è";
        } else {
            themeToggle.innerText = "üåô";
        }
        localStorage.setItem('theme', theme);
    });

    // ===========================================
    // === UPDATED: Scan function (Data Matrix) ===
    // ===========================================
    function startScan() {
        const reader = document.getElementById("reader");

        if (scannerRunning) {
            html5Scanner.stop();
            reader.style.display = "none";
            scannerRunning = false;
            return;
        }

        reader.style.display = "block";

        // --- NEW: Define the config to scan for Data Matrix ---
        const scannerConfig = {
            formatsToSupport: [
                Html5QrcodeSupportedFormats.DATA_MATRIX,
                Html5QrcodeSupportedFormats.QR_CODE
            ]
        };

        // Pass the config to the constructor
        html5Scanner = new Html5Qrcode("reader", scannerConfig);
        scannerRunning = true;

        html5Scanner.start(
            { facingMode: "environment" }, // Camera config
            { fps: 10, qrbox: 100 },       // Scanner/UI config
            (decodedText) => {
                let parts = decodedText.split("-");
                let digits = parts[3] ? parts[3] : "";
                
                // Add a new, empty slot
                addInputSlot(); 
                
                const allInputs = document.querySelectorAll('#multiInputContainer .multi-input');
                const lastInput = allInputs[allInputs.length - 1]; // Get the new slot

                lastInput.value = digits; // Set its value
                lastInput.focus(); // Focus it (this is redundant now, but safe)

                html5Scanner.stop();
                reader.style.display = "none";
                scannerRunning = false;
            },
            (error) => {
                // console.warn("Scan error:", error);
            }
        );
    }

    // --- Load data on page start (Unchanged) ---
    async function loadAndDisplayResults() {
        try {
            const response = await fetch('https://lotto.api.rayriffy.com/latest');
            if (!response.ok) throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏≤‡∏Å API");
            
            const rawData = await response.json();
            if (rawData.status !== 'success') throw new Error("API did not return success");
            
            const apiResponse = rawData.response;
            apiLottoDate = apiResponse.date;

            let data = {
                firstPrize: "", nearby: [], prize2: [], prize3: [],
                prize4: [], prize5: [], front3Digits: [], last3Digits: [],
                last2Digits: ""
            };

            apiResponse.prizes.forEach(prize => {
                switch (prize.id) {
                    case "prizeFirst":     data.firstPrize = prize.number[0]; break;
                    case "prizeFirstNear": data.nearby = prize.number; break;
                    case "prizeSecond":    data.prize2 = prize.number; break;
                    case "prizeThrid":     data.prize3 = prize.number; break;
                    case "prizeForth":     data.prize4 = prize.number; break;
                    case "prizeFifth":     data.prize5 = prize.number; break;
                }
            });

            apiResponse.runningNumbers.forEach(prize => {
                switch (prize.id) {
                    case "runningNumberFrontThree": data.front3Digits = prize.number; break;
                    case "runningNumberBackThree":  data.last3Digits = prize.number; break;
                    case "runningNumberBackTwo":    data.last2Digits = prize.number[0]; break;
                }
            });

            winningData = data;

            document.getElementById("prize-date").innerText = `(‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${apiLottoDate})`;
            document.getElementById("prize-first").innerText = data.firstPrize;
            document.getElementById("prize-front3").innerText = data.front3Digits.join(' | ');
            document.getElementById("prize-last3").innerText = data.last3Digits.join(' | ');
            document.getElementById("prize-last2").innerText = data.last2Digits;

        } catch (err) {
            document.getElementById("prize-date").innerText = "‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
            console.error(err);
        }
    }

    // --- Shared logic function (Unchanged) ---
    function getCheckResult(num) {
        let data = winningData;
        if (!data) return "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î";

        if (num === data.firstPrize) return "üéâ ‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1!";
        if (data.nearby.includes(num)) return "‚ú® ‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1!";
        if (data.prize2.includes(num)) return "üéâ ‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 2!";
        if (data.prize3.includes(num)) return "üéâ ‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 3!";
        if (data.prize4.includes(num)) return "üéâ ‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 4!";
        if (data.prize5.includes(num)) return "üéâ ‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 5!";

        let front3 = num.slice(0, 3);
        let last3 = num.slice(3);
        let last2 = num.slice(4);
        
        if (data.front3Digits.includes(front3)) return "üéâ ‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏ï‡∏±‡∏ß!";
        if (data.last3Digits.includes(last3)) return "üéâ ‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 3 ‡∏ï‡∏±‡∏ß!";
        if (last2 === data.last2Digits) return "üéâ ‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 2 ‡∏ï‡∏±‡∏ß!";

        return "‚ùå ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•";
    }
    
    // ===========================================
    // === UPDATED: addInputSlot (Auto-focus) ===
    // ===========================================
    function addInputSlot() {
        const container = document.getElementById('multiInputContainer');
        
        const newInput = document.createElement('input');
        newInput.type = 'text';
        newInput.maxLength = 6;
        newInput.placeholder = '‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å';
        newInput.className = 'multi-input';
        
        container.appendChild(newInput);
        
        // --- THIS IS THE NEW LINE ---
        newInput.focus(); // Auto-focus the new input
    }

    /**
     * This function checks all dynamic inputs AND cleans up empty ones. (Unchanged)
     */
    function checkAllSlots() {
        const resultEl = document.getElementById("multiResult");
        if (!winningData) {
            resultEl.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
            return;
        }
        
        const inputs = document.querySelectorAll('#multiInputContainer .multi-input');
        
        if (inputs.length === 0) {
            resultEl.innerHTML = "";
            return;
        }
        
        let resultsHTML = "";
        let hasContent = false;
        
        inputs.forEach(input => {
            let num = input.value.trim();
            
            if (num.length === 0) return; // Skip empty fields

            hasContent = true;
            
            if (num.length !== 6 || isNaN(num)) {
                resultsHTML += `<div class="res-line res-invalid">${num} (‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)</div>`;
            } else {
                let result = getCheckResult(num);
                if (result.includes("‚ùå")) {
                    resultsHTML += `<div class="res-line res-lose"><strong>${num}</strong>: ${result}</div>`;
                } else {
                    resultsHTML += `<div class="res-line res-win"><strong>${num}</strong>: ${result}</div>`;
                }
            }
        });
        
        if (!hasContent) {
             resultsHTML = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô";
        }
        
        resultEl.innerHTML = resultsHTML;

        // Cleanup Logic
        inputs.forEach(input => {
            const currentInputs = document.querySelectorAll('#multiInputContainer .multi-input');
            if (currentInputs.length <= 1) return; 

            if (input.value.trim() === '') {
                input.remove();
            }
        });
    }

    // --- This starts the whole app ---
    window.onload = loadAndDisplayResults;
</script>

</body>
</html>